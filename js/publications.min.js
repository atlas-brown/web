const q=e=>document.querySelector(e),qa=(e,t=document)=>[...t.querySelectorAll(e)],TYPE_LABELS={article:"Journal article",inproceedings:"Conference paper",inbook:"Book chapter",book:"Book",phdthesis:"Ph.D. dissertation",mastersthesis:"Sc.M./B.Sc./M.Eng. thesis",preprint:"Pre-print",techreport:"Technical report"};function typeLabel(e){return TYPE_LABELS[e]}function renderFilters(){const e=q("#publicationsApp"),o=q("#typeFilters"),i=q("#yearFilters"),t=qa(".pub"),a=[...new Set(t.map(e=>e.dataset.type))].sort(),r=[...new Set(t.map(e=>Number.parseInt(e.dataset.year,10)).filter(Boolean))].sort((e,t)=>t-e),n=Math.max((new Date).getFullYear(),r[0]||(new Date).getFullYear()),c=Array.from({length:5},(e,t)=>n-t),s=n-5;e&&(e.dataset.yearCutoff=String(s)),o.innerHTML=a.map(e=>`<label class="pill cursor-pointer filter-type" data-value="${e}"><span>${typeLabel(e)}</span><span class="pill-x hidden">X</span></label>`).join(""),i.innerHTML=c.map(e=>`<label class="pill cursor-pointer filter-year" data-value="${e}"><span>${e}</span><span class="pill-x hidden">X</span></label>`).concat(`<label class="pill cursor-pointer filter-year" data-value="older"><span>${s} and earlier</span><span class="pill-x hidden">X</span></label>`).join("")}function applyFilters(){const o=Number.parseInt(q("#publicationsApp")?.dataset.yearCutoff||"0",10),t=String(q("#pubSearch")?.value||"").trim().toLowerCase(),n=new Set(qa(".filter-type.selected").map(e=>e.dataset.value)),e=new Set(qa(".filter-year.selected").map(e=>e.dataset.value));let s=!1;qa(".year-block").forEach(i=>{let a=0;qa(".pub",i).forEach(i=>{const c=Number.parseInt(i.dataset.year||"0",10),l=e.size===0||e.has(i.dataset.year)||e.has("older")&&c<=o,r=(n.size===0||n.has(i.dataset.type))&&l&&(!t||(i.dataset.search||"").includes(t));i.style.display=r?"":"none",r&&(a+=1,s=!0)}),i.style.display=a?"":"none"}),q("#pubNoResults")?.classList.toggle("hidden",s)}document.addEventListener("DOMContentLoaded",()=>{const e=q("#publicationsApp");if(!e)return;renderFilters(),applyFilters(),q("#pubSearch")?.addEventListener("input",applyFilters),e.addEventListener("click",e=>{const n=e.target.closest("[data-abs-id]");if(n){q(`#${n.dataset.absId}`)?.classList.toggle("hidden");return}const t=e.target.closest(".pill");if(!t)return;t.classList.toggle("selected"),t.querySelector(".pill-x")?.classList.toggle("hidden"),applyFilters()})})